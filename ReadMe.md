# DingAnonymous - 匿名钉

![DingAnonymous - 匿名钉 Logo](img/favicon.ico)

钉钉可用的群聊匿名机器人。

## 缘起

由于COVID-2019，返校日期一拖再拖，各类课程也全面搬到了线上。

我有一门课使用的是QQ群视频。但最近有同学反映会卡顿、字小的Word文档无法在群视频的分享屏幕中看清，同时还存在着无法回看的问题。

老师便决定试用钉钉——但随之而来的问题是，这位老师并不反对我们匿名——于是上课时的QQ群中，我们便都用匿名身份来和老师交互。对学生来说，匿名不会有什么回答错误被批评的心理压力；对老师来说，允许学生匿名回答问题，实在是网课情况下了解学生上课状态的一招妙计。

为了让可能遇到卡顿的同学也能顺利流畅的上课，也为了匿名回答问题这一课堂模式，鄙人用半个下午的时间写出了这个匿名钉。

目前，“匿名钉”还是需要打开浏览器进行使用（很遗憾，钉钉机器人不可以私聊、也不可以@回复）。

另请注意，由于钉钉的机器人消息频率限制，每分钟内钉钉群中每个机器人只能发送20条消息。

## 特性与截图

- 通过钉钉群机器人以实现钉钉群匿名聊天的功能

![image-20200403175737283](img/image-20200403175737283.png)

![image-20200403175857656](img/image-20200403175857656.png)

![image-20200403180142015](img/image-20200403180142015.png)

## 安装

### 开始之前……

- 您需要有一些网络建站的基础知识
- 您需要有一台可以公网访问的服务器

### 安装使用

1. 建立一个网站根目录📂
2. git clone 到网站根目录，或前往release页面下载后上传📤
3. 拷贝`.config.json.bak`为`.config.json`，并根据说明进行编辑📝
4. 拷贝`.sendLog.db.bak`为`.sendLog.db`，并设置权限为0755
5. 整个网站根目录循环设置所有者为www
6. 访问您的网站，开始享受钉钉群内的匿名生活😀

#### 配置说明

在钉钉群中，进入“智能群助手”，选择“添加机器人”，选择自定义机器人，“安全设置”请选择“加签”，保存好生成的密钥后，点击“完成”，再记录下一个页面出现的webhook地址。

将`.config.json.bak`拷贝为`.config.json`后，应该能看到如下的内容：

```
{
    "owner": "一个以免引发歧义的名称，建议使用钉钉群名",
    "hostURL": "一个指向Web端的URL",
    "bots": [
        {
            "tag": "一个标签，只是为了方便区别，并没有什么实际意义，比如1号机",
            "secret": "申请到的第三方机器人加签密钥",
            "webhookURL": "申请到的第三方机器人Webhook"
        }
    ]
}
```

配置文件以json格式写就，按照提示修改即可。如不确定修改后格式是否正确，请自行搜索“json校验”。

如果您觉得每分钟发送20次消息是不够的，您可以申请满6个机器人（也即平均每500毫秒可发送一条消息），并在`.config.json`的`bots`键下的数组中加入它们。一个有3个机器人的配置文件应该是类似这样的：

```
……略……
    "bots": [
        {
            "tag": "0号机-Rei",
            "secret": "SEC申请到的第三方机器人加签密钥",
            "webhookURL": "申请到的第三方机器人Webhook"
        },
        {
            "tag": "1号机-Shinji",
            "secret": "申请到的第三方机器人加签密钥",
            "webhookURL": "申请到的第三方机器人Webhook"
        },
        {
            "tag": "2号机-Asuka",
            "secret": "申请到的第三方机器人加签密钥",
            "webhookURL": "申请到的第三方机器人Webhook"
        }
    ]
……略……
```

## 参考&致谢

- 钉钉开放平台文档 - [群机器人](https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq/26eaddd5)

- 使用了[MDUI](https://www.mdui.org/)的样式

## Q&A

- 为什么我上传并配置后，消息并没有发送到钉钉群？  
  请检查您的配置文件，检查`.sendLog.db`的权限，或打开PHP的错误输出进行调试、查看。

